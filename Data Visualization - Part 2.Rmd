---
title: "Data Visualization - Part 2"
subtitle: "The Good, The Bad and The Ugly"
author: "Scott Stoltzman"
date: "March 14, 2017"
output: html_document
---

----  

# Data Visualization - Part 2

##A Quick Overview of the ggplot2 Package in R  

While it will be important to focus on theory, I want to explain the ggplot2 package because I will be using it throughout the rest of this series. It's an incredibly powerful package and once you wrap your head around what it's doing, your life will change for the better! There are a lot of tools out there which provide better charts, graphs and ease of use (i.e. plot.ly, d3.js, Qlik, Tableau), but ggplot2 is still a fantastic resource and I use it all of the time. 

In case you missed it, here's a link to [Data Visualization - Part 1](https://www.stoltzmaniac.com/data-visualization-part-1/)

```{r, fig.align='center',echo=FALSE}
library(png)
library(grid)
img = readPNG("images/title_photo_2.png")
grid.raster(img)
```


### Why should you use ggplot2?  
1. More robust plotting than the base plot package
2. Better control over aesthetics - colors, axes, background, etc.
3. Layering
4. Variable Mapping (aes)
5. Automatic aggregation of data
6. Built in formulas & plotting (geom_smooth)
7. The list goes on and on...  

Basically, ggplot2 allows for a lot more customization of plots with a lot less code (the rest of it is behind the scenes). Once you are used to the syntax, there's no going back. It's faster and easier.

### Why wouldn't you use ggplot2?  
1. A bit of a learning curve
2. Lack of user interactivity with the plots  

I'll go through some of the examples from the [Top 50 ggplot2 Visualizations Master List](http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html). I will be using their examples exactly but will explain what's going on.  

**Note:** I believe the intention of the author of the [Top 50 ggplot2 Visualizations Master List](http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html) was to illustrate how to use ggplot2 rather than doing a full demonstration of what important data visualization techniques are - so keep that in mind as I go through these examples. Some of the visuals do not line up with my best practices addressed in my [first post on data visualization](https://www.stoltzmaniac.com/data-visualization-part-1/).


Fundamentally, ggplot2 gives the user the ability to start a plot and layer everything in. There are many ways to accomplish the same thing, so figure out what makes sense for you and stick to it.  

**A Basic Example: Unemployment Over Time**  

```{r,results='hide', warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
data(economics,package='ggplot2') # load the economics data
df = economics %>%
  select(date,unemploy)
ggplot(data = df) + geom_line(aes(x = date, y = unemploy))
```

### What happened to get that?  

- `ggplot(df)` loaded the data frame
- `+` tells ggplot() that there is more to be added to the plot
- `geom_line()` defined the type of plot
- `aes(x = date, y = unemploy)` mapped the variables

The `aes()` portion is what typically throws new users off but is the essence of ggplot2. In simple terms, this is what "auto-magically" brings your plot to life. You are telling ggplot2, "I want 'date' to be on the x-axis and 'unemploy' to be on the y-axis." That's pretty straightforward in this case but there are more complex use cases as well.

***Side Note:*** you could have achieved the same result by mapping the variables in the ggplot() function rather than in geom_line():
`ggplot(data = df, aes(x = date, y = unemploy)) + geom_line()`

### Here's the basic formula for success:

- Everything in ggplot starts with `ggplot(data)` and utilizes `+` to add on every element thereafter
- Include your data frame (df) in a ggplot function: `ggplot(data = df)`  
- Input the type of plot you would like (i.e. line chart of sales over time): `+ geom_line(aes(x = date, y = sales))`
    - There are ***a lot*** of types of plots - check them out [here](http://docs.ggplot2.org/current/)
- 


As usual, some packages must be loaded.
```{r, results='hide', warning=FALSE, message=FALSE}
library(reshape2)
library(lubridate)
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)
library(gridExtra)
```

### The Scatterplot  

This is one of the most visually powerful tool for data analysis. However, you have to be careful when using it because it's primarily used by people doing analysis and not reporting (depending on what industry you're in).

The author of this chart was looking for a correlation between area and population. 

`p = ggplot(data = midwest, aes(x = area, y = poptotal))` is setting up the initial plot. There are a lot of different ways to do this in ggplot2 but this is a fairly common method.

`data = midwest` is straightforward (using the midwest data frame)
`aes(x = area, y = poptotal)` this is mapping the variables. You'll notice that "area" and "poptotal" are both columns in the data frame. Think of this plot being

```{r, warning=FALSE, fig.align='center'}
options(scipen=999)  # turn-off scientific notation like 1e+48
theme_set(theme_bw())  # pre-set the bw theme.
data("midwest", package = "ggplot2")

# Scatterplot

p1 = plot(midwest$area,midwest$poptotal) #base

p2 = ggplot(data = midwest, aes(x = area, y = poptotal)) + geom_point()  #ggplot

arrangeGrob(p1, p2)
```



While the addition of the size of the points and color don't add any value, it does show the level of customization that's possible with ggplot2.

```{r}
p + geom_point(aes(col=state, size=popdensity)) + 
  geom_smooth(method="loess", se=F) + 
  xlim(c(0, 0.1)) + 
  ylim(c(0, 500000)) + 
  labs(subtitle="Area Vs Population", 
       y="Population", 
       x="Area", 
       title="Scatterplot", 
       caption = "Source: midwest")
```



#



























```{r}
data(economics,package='ggplot2') # load the economics data
econ = melt(economics[, c("date", "pce", "unemploy", "psavert")], id="date")
df = econ %>%
  filter(variable == 'pce') %>%
  group_by(date) %>%
  summarise(pce = sum(value))
```

```{r}
plot(df,type='l')
```


```{r}
p = ggplot(df, aes(x=date, y=pce, group=1))
p + geom_line() + scale_x_date()
```




```{r}
p = ggplot(econ, aes(x=date))
p + geom_line(aes(y=value,col=variable))
```

```{r}
p + geom_line(aes(y=value)) + facet_wrap(~variable)
```

```{r}
p + geom_line(aes(y=value)) + facet_wrap(~variable,ncol=1)
```


```{r}
p + geom_line(aes(y=value)) + facet_wrap(~variable,ncol=1,scales='free')
```

```{r}
df = econ %>%
  spread(variable,value)
p = ggplot(df)
p + geom_point(aes(x=pce,y=psavert))
```

```{r}
econ$year = year(econ$date)
econ$decade = '1960s'
econ$decade[econ$year >= 1970] = '1970s'
econ$decade[econ$year >= 1980] = '1980s'
econ$decade[econ$year >= 1990] = '1990s'
econ$decade[econ$year >= 2000] = '2000s'
econ$decade[econ$year >= 2010] = '2010s'
econ$decade = as.factor(econ$decade)

df = econ %>%
  spread(variable,value)
p = ggplot(df)
p + geom_point(aes(x=pce,y=psavert,col=decade))
```

```{r}
p + geom_bar(aes(x=decade,y=unemploy),stat='identity')
```


As always, the code used in this post is on my [GitHub](https://github.com/stoltzmaniac/Data-Visualization-Lesson)