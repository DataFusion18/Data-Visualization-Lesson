{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Data Visualization\"\nsubtitle: \"The Good, The Bad and The Ugly\"\nauthor: \"Scott Stoltzman\"\ndate: \"March 10, 2017\"\noutput: html_document\n---\n\n```{r setup, results='hide', warning=FALSE, message=FALSE,echo=FALSE}\nlibrary(png)\nlibrary(grid)\n```\n\n----  \n\n# Data Viz Ain't Easy\n\nIn almost every business meeting you'll attend, you will see a poorly designed chart, graph, or other visual representation of data. Most people simply lack the education required to emphasize a point.  \n\nBad visualizations can be:  \n\n- Difficult or impossible to interpret\n- Filled with completely worthless information\n- Misleading (intentionally or unintentionally)\n- Redundant and boring\n- Inaccurate\n\n\nI have to give credit to [Junk Charts](http://junkcharts.typepad.com/j) - it inspired a lot of this post.\n\n---- \n\n## Let's take a look at some examples\n\n### Every Death in Shakespeare\n**Could you imagine a worse way to show this??**  \n\n```{r, fig.align='center',echo=FALSE}\nimg = readPNG(\"images/bad-pie1.png\")\ngrid.raster(img)\n```\n    \n\n**Is this not insane!?!?!**  \n\nNo one could ever glance at that and possibly want to read it. The only thing that would have made it worse would be if there had been a legend instead of data callouts. The author could easily have used a number of other tools to get the point across. I hate wordles but due to the fact that the article wasn't trying to show the exact proportions of type of deaths, a wordle easily illustrated the point.\n  \n\n```{r, fig.align='center',echo=FALSE}\nimg = readPNG(\"images/bad-pie1-fix.png\")\ngrid.raster(img)\n```\nThis example came from this [Junk Charts Article](http://junkcharts.typepad.com/junk_charts/2016/03/which-way-to-die-the-bard-asked-onelesspie.html)\n\n----  \n\nTo be clear, I'm not even close to being perfect when it comes to visualizations in my blog. The sizes, shapes, font colors, etc. tend to get out of control and I don't want to take the time in R to tinker with all of the details. However, when it comes to displaying things professionally, it has to be spot on! So, we'll look at the theory and not worry too much about aesthetics (save that for a time when you're getting paid).\n\nLet's load up some libraries and get started.\n\n```{r libraryPrep, results='hide', warning=FALSE, message=FALSE}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(lubridate)\nlibrary(scales)\n```\n\n## Decide on what you're trying to accomplish first.  \n\nAsk yourself the following questions to help drive your decision:  \n\n- Are you making a comparison?\n- Are you finding a relationship?\n- Are you showing a distribution?\n- Are you finding a trend over time?\n- Are you showing composition?\n  \nOnce you know which question you are asking, it will keep your mind focused on the outcome and will quickly narrow down your charting options.\n\n#### Rule of Thumb  \n\n- **Trend: ** Column, Line  \n- **Comparison: ** Area, Bar, Bullet, Column, Line, Scatter  \n- **Relationship: ** Line, Scatter  \n- **Distribution: ** Bar, Boxplot, Column  \n- **Composition: ** Donut, Pie, Stacked Bar, Stacked Column  \n  \nObviously, there are choices beyond these and you need to think through your choice wisely. \n\nSide Note: I ***hate*** donut and pie charts! When used properly, they're terriffic! However, I'm very used to gagging every time one appears on a projector screen due to how frequently they're used inappropriately.\n\nFor this project, I'll use some oil production data that I found while digging through http://data.world (pretty great site). The data can be found [here](http://www.eia.gov/dnav/pet/pet_crd_crpdn_adc_mbbl_m.htm)  \n\n\n```{r dataLoading, results='hide', warning=FALSE, message=FALSE}\n#Custom data preparation\n#GitHub (linked to at bottom of this post)\nsource('data_preparation.R')\ndata = getData()\n```\n\n```{r}\nhead(data)\n```\n\n----  \n\n## Trend - Line Chart\n\n**Objective:** See what the oil production in the US looked like from 1981 - 2016 by year. I want to illustrate the changes over the time period. This is a very high-level view and only shows us a decline followed by a ramp up at the end of the period.\n\nI decided to use a line chart to show the trend over time. When using discrete data you should use a column chart to avoid any confusion that in between these years the data actually was simply linear. However, it paints a much clearer picture this way and is not misleading.\n\n### Which of these views would you rather see?\n\n#### Poor Version  \nThe x-axis is a disaster and the y-axis isn't formatted well. While it gets the point across, it's still almost worthless.\n\n\n```{r,fig.align='center', fig.width=8}\ndf = data %>% \n  group_by(Year) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel))\n\np = ggplot(df,aes(x=Year,y=ThousandBarrel,group=1)) \np + geom_line(stat='identity') + \n  ggtitle('Oil Production Over Time') + \n  theme(plot.title = element_text(hjust = 0.5),plot.subtitle = element_text(hjust = 0.5)) + \n  xlab('') + ylab('')\n```\n\n#### Better Version  \nThe title gives us a much better understanding of what we're looking at. The chart is slightly wider and the axes are formatted to be legible.\n\n```{r,fig.align='center', fig.width=12}\np = ggplot(df,aes(x=Year,y=ThousandBarrel,group=1)) \np + geom_line(stat='identity') + \n  ggtitle('Thousand Barrel Oil Production By Year in the U.S.') +\n  theme(plot.title = element_text(hjust = 0.5),plot.subtitle = element_text(hjust = 0.5)) + \n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + \n  scale_y_continuous(labels = comma)\n```\n\n\n## Comparison - Line Chart  \n\n**Objective**: Identify which states affected the trend the most. Evaluate them simultaneously in order to paint the picture and compare them.  \n\nFrom this visual you can see the top states are Alaska, California, Louisiana, Oklahoma, Texas and Wyoming. Texas seems to break the mold quite drastically and drove the spike which occurred after 2010.\n\n### Which of these views would you rather see?\n\n#### Poor Version  \nThere are far too many colors going on here. Everything at the bottom of the chart is relatively useless and takes our focus away from the big players. \n\n```{r,warning=FALSE,fig.width=10,message=FALSE}\ndf = data %>%\n  group_by(Location, Year) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel))\n\ndf$Year = as.numeric(df$Year)\n\np = ggplot(df,aes(x=Year,y=ThousandBarrel,col=Location))\np + geom_line(stat='identity') + \n  ggtitle(paste('Oil Production By Year By State in the U.S.')) + \n  theme(plot.title = element_text(hjust = 0.5)) + \n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n```\n\n#### Better Version  \nThis focuses attention on the top producing states. It compares them to each other and shows the trend per state as well.\n\n```{r,warning=FALSE,fig.width=10,message=FALSE}\nn=6 #Arbitrary at first, after trying a few, this made the most sense\ntopN = data %>%\n  group_by(Location) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel)) %>%\n  arrange(-ThousandBarrel) %>%\n  top_n(n)\n\ndf = data %>%\n  filter(Location %in% topN$Location) %>%\n  group_by(Year,Location) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel))\n\ndf$Year = as.numeric(df$Year)\ndf$Location = as.factor(df$Location)\n\np = ggplot(df,aes(x=Year,y=ThousandBarrel,group=1))\np + geom_line(stat='identity') + \n  ggtitle(paste('Top',as.character(n),'States - Oil Production By Year in the U.S.')) + \n  theme(plot.title = element_text(hjust = 0.5)) + \n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + \n  facet_wrap(~Location) + \n  scale_y_continuous(labels = comma) \n\n```\n\n\n\n## Relationship - Scatter Plot\n\n**Objective**: See if Alaska and California data is correlated (This probably isn't important but it allows us to use the same data).\n\n### Which of these views would you rather see?\n\n#### Poor Version  \nLots of completely irrelevant data! Size of the point should have nothing to do with the year.  \n\n```{r,warning=FALSE,fig.width=10,message=FALSE}\nstatesList = c('Alaska','California')\ndf = data %>%\n  filter(Location %in% statesList) %>%\n  spread(Location,ThousandBarrel) %>%\n  select(Alaska,California,Month,Year)\n\np = ggplot(df,aes(x=Alaska,y=California,col=Month,size=Year))\np + geom_point() + \n  scale_y_continuous(labels = comma) +\n  scale_x_continuous(labels = comma) +\n  ggtitle('Oil Production - CA vs. AK') + \n  theme(plot.title = element_text(hjust = 0.5))\n\n```\n\n#### Better Version  \nThe trend line is nice because it helps to visualize the relationship even more. While it can sometimes be misleading, it makes sense with our current data.  \n\n```{r,warning=FALSE,fig.width=10,message=FALSE}\ndf = data %>%\n  filter(Location %in% statesList) %>%\n  spread(Location,ThousandBarrel) %>%\n  select(Alaska,California,Year)\n\np = ggplot(df,aes(x=Alaska,y=California))\np + geom_point() + \n  scale_y_continuous(labels = comma) +\n  scale_x_continuous(labels = comma) +\n  ggtitle('Monthly Thousand Barrel Oil Production 1981-2016 CA vs. AK') + \n  theme(plot.title = element_text(hjust = 0.5)) + \n  geom_smooth(method='lm')\n\n```\n\n\n\n\n## Distribution - Boxplot \n\n**Objective**: Examine the range of production by state and year over the time period to give us an idea of the variance.\n\n### Which of these views would you rather see?\n\n#### Poor Version  \n\n\n```{r,warning=FALSE,fig.width=10,message=FALSE}\ndf = data %>%\n  group_by(Year,Location) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel))\n\np = ggplot(df,aes(x=Location,y=ThousandBarrel))\np + geom_boxplot() + \n  ggtitle('Distribution of Oil Production by State')\n\n```\n\n\n#### Better Version  \nThis gives a nice ranking to the plot while still showing their distributions. While it was semi-apparent in the line charts, the variance of Texas is huge compared to the others! We could take this a step further and separate out the big players from the smaller players.\n\n```{r,warning=FALSE,fig.width=10,message=FALSE}\np = ggplot(df,aes(x=reorder(Location,ThousandBarrel),y=ThousandBarrel))\np + geom_boxplot() + \n  scale_y_continuous(labels = comma) +\n  ggtitle('Distribution of Annual Oil Production By State (1981 - 2016)') + \n  coord_flip()\n```\n\n\n## Composition - Stacked Bar \n\n**Objective**: Check out the composition of total production by state.\n\n### Which of these views would you rather see?\n\n#### Poor Version  \nMy favorite, the beautiful pie chart! There's nothing better than this...\n\n```{r,warning=FALSE,fig.width=10,message=FALSE}\ndf = data %>%\n  group_by(Location) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel)) %>%\n  mutate(ThousandBarrel = ThousandBarrel/sum(ThousandBarrel))\n\ndf$ThousandBarrel = round(100*df$ThousandBarrel,0)\n\nlibrary(plotrix)\npie(x=df$ThousandBarrel,labels=df$Location,explode=0.1,col=rainbow(nrow(df)),main='Percentage of Oil Production by State')\n\n```\n\n\n#### Better Version  \nThe 1980's and 2010's will be missing years in terms of a \"decade\" due to the data provided (and it's only 2017). While the percentage labels are slightly off center, it's certainly much better than the pie chart. It's not quite \"apples-to-apples\" for a comparison because I created different decades, but you get the idea.\n\nI also created an \"Other\" category in order to simplify the output. When you are doing comparisons, it's typically a good idea to find a way to reduce the number of variables in the output while not removing data by dropping it completely.\n\n```{r,warning=FALSE,fig.width=10,message=FALSE}\ndata$Decade = '1980s'\ndata$Decade[data$Year >= 1990] = '1990s'\ndata$Decade[data$Year >= 2000] = '2000s'\ndata$Decade[data$Year >= 2010] = '2010s'\ndata$Decade = as.factor(data$Decade)\n\ntop5 = data %>%\n  group_by(Location) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel)) %>%\n  arrange(-ThousandBarrel) %>%\n  top_n(5) %>%\n  select(Location)\n\ntop5List = top5$Location\n\ndata$State = \"Other\"\n\nfor(i in 1:length(top5List)){\n  data$State[data$Location == top5List[i]] = top5List[i]\n}\n\ndf = data %>%\n  group_by(Decade,State) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel)) %>%\n  mutate(ThousandBarrel = ThousandBarrel/sum(ThousandBarrel))\n\ndf$ThousandBarrel = round(df$ThousandBarrel,3)\ndf$text = paste(round(100*df$ThousandBarrel,0),'%', sep='')\n\np = ggplot(df,aes(x=Decade,y=ThousandBarrel,col=reorder(State,ThousandBarrel),fill=reorder(State,ThousandBarrel)))\np + geom_bar(stat='identity') + \n  geom_text(aes(label=text),col='Black',size = 4, hjust = 0.5, vjust = 3, position = \"stack\") + \n  scale_y_continuous(labels = percent) +\n  ggtitle('Percentage of Top Oil Producing States by Decade') + \n  guides(fill=guide_legend(title='State'),col=guide_legend(title='State')) + \n  theme(plot.title = element_text(hjust = 0.5))\n\n```\n\n\n\n\n### Some other fun concepts are below!  \nSome of them are nice, others are terrible! I won't comment on any of them, but I felt it was necessary to include some other ideas I toyed around with. \n\nHave fun with your data visualizations. The charts I showed here are extremely simple. Being creative by using things other than R wind up making visuals people can remember. There are plenty of examples around, but they all tend to follow basic principles of design. There are ***A TON*** of good books out there on this topic. \n\nNow it's your turn!\n\n\n```{r}\ndf = data %>% \n  group_by(Location) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel)) %>%\n  arrange(-ThousandBarrel)\np = ggplot(df,aes(x=reorder(Location,ThousandBarrel),y=ThousandBarrel))\np + geom_bar(stat='identity') + \n  ggtitle('Oil Production 1981 - 2016 By Location') + \n  theme(plot.title = element_text(hjust = 0.5)) + \n  coord_flip()\n```\n\n\n\n\n\n```{r}\ntop10 = data %>%\n  group_by(Location) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel)) %>%\n  arrange(-ThousandBarrel) %>%\n  top_n(10)\nprint(top10)\n\ndf = data %>% \n  group_by(Location,Year) %>%\n  filter(Location %in% top10$Location) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel)) \np = ggplot(df,aes(x=Year,y=ThousandBarrel,col=Location,fill=Location))\np + geom_bar(stat='identity') + \n  ggtitle('Oil Production - Top 10 States') + \n  theme(plot.title = element_text(hjust = 0.5)) + \n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n```\n\n\n\n```{r, fig.width=10}\ndf = data %>%\n  filter(Year == 1990)%>%\n  group_by(Location) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel))\ndf$Location = tolower(df$Location)\n\n#Add States without data\nStates = data.frame(Location = tolower(as.character(state.name)))\nmissingStates = States$Location[!(States$Location %in% df$Location)]\nappendData = data.frame(Location=missingStates,ThousandBarrel=0)\ndf = rbind(df,appendData)\n\nstates_map <- map_data(\"state\")\n\nggplot(df, aes(map_id = Location)) + \n    geom_map(aes(fill=ThousandBarrel), map = states_map) +\n    expand_limits(x = states_map$long, y = states_map$lat)\n\n```\n\n\n```{r}\ndf = data %>% \n  filter(Location == 'Texas') %>%\n  group_by(Year,Month) %>%\n  summarise(ThousandBarrel = sum(ThousandBarrel))\n\np = ggplot(df,aes(x=Month,y=ThousandBarrel))\np + geom_line(stat='identity',aes(group=Year,col=Year)) + \n  ggtitle('Oil Production By Year in the U.S.') + \n  theme(plot.title = element_text(hjust = 0.5)) + \n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n```\n\n\nAs always, the code used in this post is on my [GitHub](https://github.com/stoltzmaniac/Data-Visualization-Lesson)",
    "created" : 1489161916076.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1953550740",
    "id" : "999FEB3A",
    "lastKnownWriteTime" : 1489189540,
    "last_content_update" : 1489416504670,
    "path" : "~/Documents/GitHub/Data-Visualization-Lesson/Data Visualization Lesson.Rmd",
    "project_path" : "Data Visualization Lesson.Rmd",
    "properties" : {
        "last_setup_crc32" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}